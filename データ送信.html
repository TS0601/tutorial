<!DOCTYPE html>
<html>
  <head>
    <title>試作</title>
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-firestore.js"></script>

<script>

    firebase.initializeApp({
      apiKey: "AIzaSyBgmke1S6n1nKQZ0Ez6kJ85o3PEOklyKbI",
      authDomain: "qualification-master.firebaseapp.com",
      databaseURL: "https://qualification-master.firebaseio.com",
      projectId: "qualification-master",
      storageBucket: "qualification-master.appspot.com",
      messagingSenderId: "733843168310",
      appId: "1:733843168310:web:1aa23bde7d4373dd"
    });
    
    // Initialize Cloud Firestore through Firebase
    var db = firebase.firestore();

var usersRef = db.collection("users");

// Add a new document in collection "cities"
usersRef.doc("テストユーザ").set({
      sample1:{
        学習日:new Date("May 27, 2019"),
        学習進捗:true,
        "q1-1":true,
        "q1-2":false,
      },
      sample2:{
        学習日:new Date("june 1, 2019"),
        学習進捗:true,
        "q1-1":true,
        "q1-2":true,
        "q2-1":true,
      },
    })
.then(function() {
    console.log("Document successfully written!");
})
.catch(function(error) {
    console.error("Error writing document: ", error);
});

// 追加

usersRef.doc("テストユーザ").set({
      sample1:{
        "q1-3": false,
      },
      sample3:{
        学習日:new Date("june 3, 2019"),
        学習進捗:true,
        "q1-1":false,
        "q1-2":true,
        "q2-1":false,
      },
    },
  {merge: true}//重要
  )
.then(function() {
    console.log("Document successfully updated!");
})
.catch(function(error) {
    // The document probably doesn't exist.
    console.error("Error updating document: ", error);
});

// 更新(処理はほとんど追加と同じ)

usersRef.doc("テストユーザ").set({

      sample1:{
        学習日:new Date("june 5, 2019"),
        "q1-2": true,
      },
    },
  {merge: true}//重要
  )
.then(function() {
    console.log("Document successfully updated!");
})
.catch(function(error) {
    // The document probably doesn't exist.
    console.error("Error updating document: ", error);
});

// ドキュメントの取得

var docRef = db.collection("users").doc("テストユーザ");

docRef.get().then(function(doc) {
    if (doc.exists) {
        console.log("Document data:", doc.data());
    } else {
        // doc.data() will be undefined in this case
        console.log("No such document!");
    }
}).catch(function(error) {
    console.log("Error getting document:", error);
});

//日付取得

  myTbl     = new Array("日","月","火","水","木","金","土");
  myD       = new Date();
  myYear    = myD.getYear()
  myYear4   = (myYear < 2000) ? myYear+1900 : myYear;
  myMonth   = myD.getMonth() + 1;
  myDate    = myD.getDate();
  myDay     = myD.getDay();
  myHours   = myD.getHours();
  myMinutes = myD.getMinutes();
  mySeconds = myD.getSeconds();

  myMess1   = myYear4 + "年" + myMonth + "月" + myDate + "日";
  myMess2   = myTbl[myDay] + "曜日";
  myMess3   = myHours + "時" + myMinutes + "分" + mySeconds + "秒";
  myMess    = myMess1 + " " + myMess2 + " " + myMess3;

// サイトから送信データを試す
usersRef.doc(document.getElementsByName("氏名")).set({
      sample1:{
        //document.write(location.pathname)を入れたいがそのまま入れるとエラーになる。
        学習日:document.write(location.pathname),
        学習進捗:document.getElementsByName("進捗").value,
        "q1-1":document.getElementById("q1-1").value,
        "q1-2":document.getElementById("q1-2").value,
        //ここは問題の数に応じてforループで回せば良さそう
      },
      sample2:{
        学習日:document.write(location.pathname),
        学習進捗:document.getElementsByName("進捗").value,
        "q1-1":document.getElementById("q1-1").value,
        "q1-2":document.getElementById("q1-2").value,
        "q2-1":document.getElementById("q2-1").value,
      },
    },{merge: true})
.then(function() {
    console.log("Document successfully written!");
})
.catch(function(error) {
    console.error("Error writing document: ", error);
});

</script>

  </head>
  <body>
    <p>試作品</p>
  
    <form method="post" action="CGIのURI">
      <p>
      ユーザ名：<input type="text" name="氏名" /></br>
      該当URL：<script>document.write(location.pathname);</script></br>
      問題結果(q1-1)：
      <input type="radio" id="q1-1" value="true"> 正解
      <input type="radio" id="q1-1" value="false"> 不正解</br>
      問題結果(q1-2)：
      <input type="radio" id="q1-2" value="true"> 正解
      <input type="radio" id="q1-2" value="false"> 不正解</br>
      問題結果(q2-1)：
      <input type="radio" id="q2-1" value="true"> 正解
      <input type="radio" id="q2-1" value="false"> 不正解</br>
      
      日付：<script>document.write(myMess);</script></br>

     進捗：
       <input type="radio" name="進捗" value="true"> 済
       <input type="radio" name="進捗" value="false"> 未</br>       

       <button onclick="datasend()">送信する</button>
      </p>
     </form>

  </body>
</html>